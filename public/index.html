<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Add to Calendar Redirect</title>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Lấy tham số ?event=...
            const urlParams = new URLSearchParams(window.location.search);
            const event = urlParams.get("event") || "dka";

            // Mapping event -> link
            const events = {
                "dka": {
                    outlook: "https://outlook.office.com/calendar/0/deeplink/compose?subject=From%20Risk%20to%20Response%3A%20Unlocking%20DKA%20Prevention%20with%20Dual%20Glucose%20Ketone%20Sensing&body=Join%20us%20to%20explore%20how%20dual%20glucose%20and%20ketone%20sensing%20helps%20unlock%20DKA%20prevention.&startdt=2025-09-16T12:15:00Z&enddt=2025-09-16T12:45:00Z&location=Virtual",
                    google: "https://calendar.google.com/calendar/render?action=TEMPLATE&text=From+Risk+to+Response%3A+Unlocking+DKA+Prevention+with+Dual+Glucose+Ketone+Sensing&dates=20250916T121500Z/20250916T124500Z&details=Join+us+to+explore+how+dual+glucose+and+ketone+sensing+helps+unlock+DKA+prevention.&location=Virtual",
                    ics: "https://calendar-redirect-omega.vercel.app/event-dka.ics"
                },
                "cgm": {
                    outlook: "https://outlook.office.com/calendar/0/deeplink/compose?subject=Beyond%20MDI%3A%20Why%20CGM%20Belongs%20in%20Every%20Type%202%20Diabetes%20Care%20Plan&body=Join%20us%20for%20a%20session%20on%20why%20Continuous%20Glucose%20Monitoring%20%28CGM%29%20belongs%20in%20every%20Type%202%20diabetes%20care%20plan.&startdt=2025-09-19T09:00:00Z&enddt=2025-09-19T09:30:00Z&location=Virtual",
                    google: "https://calendar.google.com/calendar/render?action=TEMPLATE&text=Beyond+MDI%3A+Why+CGM+Belongs+in+Every+Type+2+Diabetes+Care+Plan&dates=20250919T090000Z/20250919T093000Z&details=Join+us+for+a+session+on+why+Continuous+Glucose+Monitoring+%28CGM%29+belongs+in+every+Type+2+diabetes%20care%20plan.&location=Virtual",
                    ics: "https://calendar-redirect-omega.vercel.app/event-cgm.ics"
                }
            };

            const ua = navigator.userAgent.toLowerCase();
            const links = events[event] || events["dka"]; // fallback

            if (ua.includes("outlook") || ua.includes("microsoft")) {
                window.location.href = links.outlook;
            } else if (ua.includes("gmail") || ua.includes("android") || ua.includes("google")) {
                window.location.href = links.google;
            } else if (ua.includes("iphone") || ua.includes("ipad") || ua.includes("macintosh")) {
                window.location.href = links.ics; // Apple Calendar tự mở file .ics
            } else {
                window.location.href = links.ics; // fallback: download .ics
            }
        });
    </script>
</head>

<body>
    <p>Redirecting to your calendar...</p>
</body>

</html>